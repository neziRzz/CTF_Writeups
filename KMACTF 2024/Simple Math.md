- Đề cho 1 file PE64

![image](https://github.com/user-attachments/assets/0ac3dcf8-d094-4f9a-a137-2337268b0db4)

- Pseudocode của IDA (Mình đã đổi tên một số hàm để tiện hơn cho việc phân tích)
```C
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char *v3; // rax
  __int64 v4; // rax
  __int64 v5; // rax
  int v7; // [rsp+20h] [rbp-708h]
  int i; // [rsp+24h] [rbp-704h]
  int j; // [rsp+28h] [rbp-700h]
  int k; // [rsp+2Ch] [rbp-6FCh]
  int v11; // [rsp+30h] [rbp-6F8h]
  int v12; // [rsp+34h] [rbp-6F4h]
  int v13; // [rsp+38h] [rbp-6F0h]
  int v14; // [rsp+3Ch] [rbp-6ECh]
  int v15; // [rsp+40h] [rbp-6E8h]
  int v16; // [rsp+44h] [rbp-6E4h]
  int v17; // [rsp+48h] [rbp-6E0h]
  int v18; // [rsp+4Ch] [rbp-6DCh]
  __int64 v19; // [rsp+50h] [rbp-6D8h]
  int v20[20]; // [rsp+60h] [rbp-6C8h]
  int v21[20]; // [rsp+B0h] [rbp-678h]
  int v22[160]; // [rsp+100h] [rbp-628h]
  int v23[160]; // [rsp+380h] [rbp-3A8h]
  __int64 v24; // [rsp+600h] [rbp-128h]
  char *v25; // [rsp+608h] [rbp-120h]
  __int64 v26; // [rsp+610h] [rbp-118h]
  char v27[32]; // [rsp+618h] [rbp-110h] BYREF
  char v28[32]; // [rsp+638h] [rbp-F0h] BYREF
  char input[32]; // [rsp+658h] [rbp-D0h] BYREF
  char v30[32]; // [rsp+678h] [rbp-B0h] BYREF
  char v31[32]; // [rsp+698h] [rbp-90h] BYREF
  char v32[32]; // [rsp+6B8h] [rbp-70h] BYREF
  char v33[32]; // [rsp+6D8h] [rbp-50h] BYREF
  char v34[32]; // [rsp+6F8h] [rbp-30h] BYREF

  alloc_mem(input);
  call_cout(std::cout, "Enter something: ");
  call_cin(std::cin, input);
  v21[0] = 2741159;
  v21[1] = 2807211;
  v21[2] = 3698913;
  v21[3] = 3335627;
  v21[4] = 3764965;
  v21[5] = 3137471;
  v21[6] = 3335627;
  v21[7] = 1717352;
  v21[8] = 3797991;
  v21[9] = 3996147;
  v21[10] = 3137471;
  v21[11] = 2543003;
  v21[12] = 3302601;
  v21[13] = 1750378;
  v21[14] = 3137471;
  v21[15] = 2212743;
  v21[16] = 2708133;
  v21[17] = 1717352;
  v21[18] = 2212743;
  v21[19] = 2476951;
  v22[0] = 1816430;
  v22[1] = 1717352;
  v22[2] = 1783404;
  v22[3] = 3368653;
  v22[4] = 1618274;
  v22[5] = 1750378;
  v22[6] = 1684326;
  v22[7] = 1816430;
  v22[8] = 1684326;
  v22[9] = 3203523;
  v22[10] = 1651300;
  v22[11] = 1816430;
  v22[12] = 1750378;
  v22[13] = 3335627;
  v22[14] = 1684326;
  v22[15] = 1717352;
  v22[16] = 1684326;
  v22[17] = 1684326;
  v22[18] = 1585248;
  v22[19] = 1618274;
  v22[20] = 1585248;
  v22[21] = 3335627;
  v22[22] = 1684326;
  v22[23] = 1750378;
  v22[24] = 1651300;
  v22[25] = 3203523;
  v22[26] = 3236549;
  v22[27] = 3335627;
  v22[28] = 3236549;
  v22[29] = 3368653;
  v22[30] = 1849456;
  v22[31] = 1816430;
  v22[32] = 1717352;
  v22[33] = 1585248;
  v22[34] = 3368653;
  v22[35] = 1717352;
  v22[36] = 1816430;
  v22[37] = 1651300;
  v22[38] = 1684326;
  v22[39] = 1585248;
  v22[40] = 3368653;
  v22[41] = 1750378;
  v22[42] = 3203523;
  v22[43] = 3302601;
  v22[44] = 1651300;
  v22[45] = 1651300;
  v22[46] = 1717352;
  v22[47] = 1849456;
  v22[48] = 1882482;
  v22[49] = 1816430;
  v22[50] = 1816430;
  v22[51] = 1783404;
  v22[52] = 1717352;
  v22[53] = 3203523;
  v22[54] = 1684326;
  v22[55] = 3368653;
  v22[56] = 1882482;
  v22[57] = 1816430;
  v22[58] = 3203523;
  v22[59] = 3368653;
  v22[60] = 1849456;
  v22[61] = 1585248;
  v22[62] = 1750378;
  v22[63] = 1816430;
  v22[64] = 3236549;
  v22[65] = 1783404;
  v22[66] = 3236549;
  v22[67] = 3236549;
  v22[68] = 1585248;
  v22[69] = 3236549;
  v22[70] = 3335627;
  v22[71] = 1750378;
  v22[72] = 3269575;
  v22[73] = 1684326;
  v22[74] = 1684326;
  v22[75] = 1717352;
  v22[76] = 1783404;
  v22[77] = 1783404;
  v22[78] = 1882482;
  v22[79] = 3368653;
  v22[80] = 3236549;
  v22[81] = 3269575;
  v22[82] = 1717352;
  v22[83] = 3236549;
  v22[84] = 1750378;
  v22[85] = 1717352;
  v22[86] = 1849456;
  v22[87] = 3335627;
  v22[88] = 3236549;
  v22[89] = 3236549;
  v22[90] = 1816430;
  v22[91] = 3236549;
  v22[92] = 3203523;
  v22[93] = 1684326;
  v22[94] = 3335627;
  v22[95] = 1651300;
  v22[96] = 1783404;
  v22[97] = 1717352;
  v22[98] = 1618274;
  v22[99] = 3368653;
  v22[100] = 3203523;
  v22[101] = 1750378;
  v22[102] = 3335627;
  v22[103] = 1717352;
  v22[104] = 1750378;
  v22[105] = 3236549;
  v22[106] = 3302601;
  v22[107] = 1882482;
  v22[108] = 1750378;
  v22[109] = 1684326;
  v22[110] = 3269575;
  v22[111] = 1816430;
  v22[112] = 1684326;
  v22[113] = 1684326;
  v22[114] = 1585248;
  v22[115] = 1816430;
  v22[116] = 1882482;
  v22[117] = 1585248;
  v22[118] = 1651300;
  v22[119] = 3368653;
  v22[120] = 1783404;
  v22[121] = 1783404;
  v22[122] = 3302601;
  v22[123] = 3302601;
  v22[124] = 1618274;
  v22[125] = 1783404;
  v22[126] = 1816430;
  v22[127] = 1684326;
  v22[128] = 1882482;
  v22[129] = 1849456;
  v22[130] = 3203523;
  v22[131] = 3236549;
  v22[132] = 3335627;
  v22[133] = 1684326;
  v22[134] = 3203523;
  v22[135] = 1651300;
  v22[136] = 1849456;
  v22[137] = 1684326;
  v22[138] = 1849456;
  v22[139] = 1684326;
  v22[140] = 1750378;
  v22[141] = 1585248;
  v22[142] = 1618274;
  v22[143] = 3368653;
  v22[144] = 1717352;
  v22[145] = 3236549;
  v22[146] = 3368653;
  v22[147] = 3302601;
  v22[148] = 1651300;
  v22[149] = 3302601;
  v22[150] = 1882482;
  v22[151] = 1585248;
  v22[152] = 1816430;
  v22[153] = 1816430;
  v22[154] = 1849456;
  v22[155] = 1651300;
  v22[156] = 1585248;
  v22[157] = 3368653;
  v22[158] = 1618274;
  v22[159] = 1618274;
  v7 = 0;
  sub_7FF6C5843860(v31, &unk_7FF6C5848489);
  while ( v7 < 400 )
  {
    if ( *(_BYTE *)sub_7FF6C58436B0(input, 0i64) == 'E' )
    {
      v20[0] = 3236549;
      v20[1] = 3203523;
      v20[2] = 3632861;
      v20[3] = 3137471;
      v20[4] = 3302601;
      v20[5] = 3203523;
      v20[6] = 3137471;
      v20[7] = 3236549;
      v20[8] = 3467731;
      v20[9] = 3137471;
      v20[10] = 3566809;
      v20[11] = 3864043;
      v20[12] = 3203523;
      v20[13] = 1089858;
      v20[14] = 1089858;
      v20[15] = 1089858;
      v20[16] = 1089858;
      v20[17] = 1089858;
      v20[18] = 1089858;
      v20[19] = 1089858;
      v14 = 127 * v20[dword_7FF6C584B100[v7]];
      v15 = (*(char *)sub_7FF6C58436B0(input, dword_7FF6C584B100[v7]) + v14) >> 22;
      std::string::operator+=(v31, (unsigned __int8)v15);
    }
    else
    {
      v16 = 127 * v21[dword_7FF6C584B100[v7]];
      v17 = (*(char *)sub_7FF6C58436B0(input, dword_7FF6C584B100[v7]) + v16) >> 22;
      std::string::operator+=(v31, (unsigned __int8)v17);
    }
    v7 += 21;
  }
  v19 = sub_7FF6C5842040();
  sub_7FF6C5843860(v30, "Correct?");
  if ( (unsigned __int8)sub_7FF6C5844D40(v19, "1") )
  {
    v23[0] = 1585248;
    v23[1] = 1882482;
    v23[2] = 3302601;
    v23[3] = 1618274;
    v23[4] = 1750378;
    v23[5] = 3236549;
    v23[6] = 1882482;
    v23[7] = 3368653;
    v23[8] = 1651300;
    v23[9] = 1717352;
    v23[10] = 1783404;
    v23[11] = 1717352;
    v23[12] = 3269575;
    v23[13] = 3368653;
    v23[14] = 1585248;
    v23[15] = 1651300;
    v23[16] = 1651300;
    v23[17] = 1849456;
    v23[18] = 1717352;
    v23[19] = 3203523;
    v23[20] = 1816430;
    v23[21] = 3335627;
    v23[22] = 1618274;
    v23[23] = 3203523;
    v23[24] = 3236549;
    v23[25] = 3302601;
    v23[26] = 3236549;
    v23[27] = 1618274;
    v23[28] = 3368653;
    v23[29] = 3302601;
    v23[30] = 1618274;
    v23[31] = 1816430;
    v23[32] = 3335627;
    v23[33] = 1816430;
    v23[34] = 3269575;
    v23[35] = 1750378;
    v23[36] = 1585248;
    v23[37] = 3335627;
    v23[38] = 3203523;
    v23[39] = 1816430;
    v23[40] = 1849456;
    v23[41] = 1717352;
    v23[42] = 3269575;
    v23[43] = 1684326;
    v23[44] = 1684326;
    v23[45] = 3368653;
    v23[46] = 1717352;
    v23[47] = 3269575;
    v23[48] = 1882482;
    v23[49] = 3203523;
    v23[50] = 3368653;
    v23[51] = 1783404;
    v23[52] = 3269575;
    v23[53] = 1618274;
    v23[54] = 1585248;
    v23[55] = 1849456;
    v23[56] = 1849456;
    v23[57] = 1717352;
    v23[58] = 3368653;
    v23[59] = 1717352;
    v23[60] = 1684326;
    v23[61] = 1651300;
    v23[62] = 3236549;
    v23[63] = 1618274;
    v23[64] = 1618274;
    v23[65] = 3236549;
    v23[66] = 1849456;
    v23[67] = 1882482;
    v23[68] = 1618274;
    v23[69] = 1585248;
    v23[70] = 3302601;
    v23[71] = 1651300;
    v23[72] = 1882482;
    v23[73] = 1717352;
    v23[74] = 1750378;
    v23[75] = 1783404;
    v23[76] = 1651300;
    v23[77] = 1849456;
    v23[78] = 3302601;
    v23[79] = 1618274;
    v23[80] = 1816430;
    v23[81] = 1816430;
    v23[82] = 1651300;
    v23[83] = 1651300;
    v23[84] = 3236549;
    v23[85] = 3203523;
    v23[86] = 1717352;
    v23[87] = 1618274;
    v23[88] = 1816430;
    v23[89] = 1651300;
    v23[90] = 3368653;
    v23[91] = 3335627;
    v23[92] = 1783404;
    v23[93] = 3302601;
    v23[94] = 3269575;
    v23[95] = 1849456;
    v23[96] = 1618274;
    v23[97] = 3236549;
    v23[98] = 3335627;
    v23[99] = 3335627;
    v23[100] = 3335627;
    v23[101] = 3335627;
    v23[102] = 1849456;
    v23[103] = 1849456;
    v23[104] = 1618274;
    v23[105] = 1651300;
    v23[106] = 1816430;
    v23[107] = 3236549;
    v23[108] = 3236549;
    v23[109] = 3368653;
    v23[110] = 3203523;
    v23[111] = 3368653;
    v23[112] = 3368653;
    v23[113] = 3236549;
    v23[114] = 3335627;
    v23[115] = 3302601;
    v23[116] = 3335627;
    v23[117] = 3203523;
    v23[118] = 1618274;
    v23[119] = 1783404;
    v23[120] = 1618274;
    v23[121] = 3302601;
    v23[122] = 1849456;
    v23[123] = 1651300;
    v23[124] = 1750378;
    v23[125] = 1651300;
    v23[126] = 1684326;
    v23[127] = 1585248;
    v23[128] = 3269575;
    v23[129] = 3236549;
    v23[130] = 1618274;
    v23[131] = 3269575;
    v23[132] = 3203523;
    v23[133] = 1585248;
    v23[134] = 1585248;
    v23[135] = 1849456;
    v23[136] = 1651300;
    v23[137] = 1651300;
    v23[138] = 1717352;
    v23[139] = 1783404;
    v23[140] = 1816430;
    v23[141] = 1750378;
    v23[142] = 3203523;
    v23[143] = 1816430;
    v23[144] = 1618274;
    v23[145] = 1750378;
    v23[146] = 1849456;
    v23[147] = 3236549;
    v23[148] = 1585248;
    v23[149] = 3335627;
    v23[150] = 3335627;
    v23[151] = 1684326;
    v23[152] = 3368653;
    v23[153] = 3302601;
    v23[154] = 1684326;
    v23[155] = 3335627;
    v23[156] = 3335627;
    v23[157] = 1585248;
    v23[158] = 1849456;
    v23[159] = 3269575;
    for ( i = 0; i < 160; ++i )
      v22[i] = v23[i];
    v24 = sub_7FF6C5843620(v30, v27, 0i64, 7i64);
    sub_7FF6C58437E0(v30, v24);
    sub_7FF6C58437B0(v27);
    v19 = sub_7FF6C5841F00();
  }
  v11 = 0;
  v13 = 1;
  for ( j = 0; j <= 4; ++j )
  {
    sub_7FF6C5843860(v32, &unk_7FF6C584848A);
    std::shared_ptr<__ExceptionPtr>::operator=(v34, 32i64 * j + v19);
    v12 = 0;
    v25 = v28;
    v26 = sub_7FF6C5843620(v31, v28, 4 * j, 4i64);
    sub_7FF6C5841DB0(v33, v26);
    for ( k = v11; k < v11 + 32; ++k )
    {
      v18 = 127 * v22[k];
      v3 = (char *)sub_7FF6C58436B0(v34, v12);
      std::string::operator+=(v32, (unsigned __int8)((*v3 + v18) >> 22));
      ++v12;
    }
    v11 += 32;
    if ( (unsigned __int8)check(v33, v32) )
      v13 = 0;
    sub_7FF6C58437B0(v33);
    sub_7FF6C58437B0(v34);
    sub_7FF6C58437B0(v32);
  }
  if ( !v13 )
  {
    v5 = call_cout(std::cout, "Something unto death?");
    std::ostream::operator<<(v5, sub_7FF6C5844E00);
    ExitProcess(0xFFFFFFFF);
  }
  v4 = sub_7FF6C5844DB0(std::cout, v30);
  std::ostream::operator<<(v4, sub_7FF6C5844E00);
  sub_7FF6C58437B0(v30);
  sub_7FF6C58437B0(v31);
  sub_7FF6C58437B0(input);
  return 0;
}
```
- Ta có thể thấy rằng chương trình ban đầu sẽ nhận input, sau đó dựa vào kí tự đầu tiên của input sẽ chia ra làm 2 luồng (kiểm tra xem kí tự đầu tiên có phải là `E` hay không)
- Dựa vào vòng lặp while ở trên ta cũng có thể suy ra được độ dài của input là 20
- Khi mình thử để thử input có kí tự `E` ở đầu và các kí tự còn lại đều là random thì chương trình gen ra 1 chuỗi khá kì lạ

![image](https://github.com/user-attachments/assets/6ac20902-bb66-4411-843b-9b90122bb6be)

- Từ đây ta có thể suy ra rằng các kí tự này sẽ được gen ra một cách cố định và sẽ không phụ thuộc quá nhiều vào input
- Và bất ngờ thay khi mình thử để input là 20 kí tự `x` thì lại được flag :))) (vì một lí do nào đó mà IDA không show hết được chỗ chuỗi đó nên mình debug trong x64dbg)

![image](https://github.com/user-attachments/assets/5376f8d4-8543-45c1-a849-8e3d54656c72)

- Thực ra mình làm ra được như thế này thì là do một kĩ thuật tên là hash collision (https://en.wikipedia.org/wiki/Hash_collision) các bạn chỉ cần tạo ra một chuỗi có cùng md5 hash với `v32` nhưng mà các bạn muốn một cách tiếp cận chắc chắn hơn thì có thể bruteforce các kí tự input bằng cách dùng chuỗi `SUper_e4sy_Md5_CR4CK` làm key thì sẽ ra được input chuẩn
**Flag:**``KMACTF{SUper_e4sy_Md5_CR4CK}``

